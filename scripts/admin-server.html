<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Radar de Tendências - Admin</title>
  
  <!-- jQuery primeiro! -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
  <!-- Bootstrap CSS e JS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  
  <!-- Chart.js para gráficos -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  
  <style>
    .card-header {
      font-weight: bold;
    }
    .status-ativo {
      color: green;
      font-weight: bold;
    }
    .status-inativo {
      color: red;
    }
    
    /* Estilos para o Kanban */
    .kanban-column {
      margin-bottom: 20px;
    }
    
    .kanban-cards {
      min-height: 300px;
      max-height: 600px;
      overflow-y: auto;
    }
    
    .kanban-card {
      margin-bottom: 10px;
      cursor: pointer;
      border-left: 4px solid #6c757d;
    }
    
    .kanban-card-novo {
      border-left-color: #17a2b8;
    }
    
    .kanban-card-onboarding {
      border-left-color: #ffc107;
    }
    
    .kanban-card-ativo {
      border-left-color: #28a745;
    }
    
    .kanban-card-inativo {
      border-left-color: #6c757d;
    }
    
    .kanban-card-dragging {
      opacity: 0.5;
    }
    
    .kanban-card-header {
      padding: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .kanban-card-body {
      padding: 8px;
      font-size: 12px;
    }
    
    .kanban-card-footer {
      padding: 5px 8px;
      background-color: #f8f9fa;
      font-size: 11px;
      color: #6c757d;
      display: flex;
      justify-content: space-between;
    }
    
    .kanban-card .dropdown-menu {
      min-width: 150px;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-dark bg-primary">
    <div class="container">
      <a class="navbar-brand" href="#">
        <i class="fas fa-radar"></i> Radar de Tendências - Painel Administrativo
      </a>
    </div>
  </nav>

  <div class="container mt-4">
    <!-- Tabs para navegação -->
    <ul class="nav nav-tabs" id="adminTabs" role="tablist">
      <li class="nav-item">
        <a class="nav-link active" id="usuarios-tab" data-toggle="tab" href="#usuarios" role="tab">Usuários</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="conteudos-tab" data-toggle="tab" href="#conteudos" role="tab">Conteúdos Gerados</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="kanban-tab" data-toggle="tab" href="#kanban" role="tab">Kanban de Jornada</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="perfis-tab" data-toggle="tab" href="#perfis" role="tab">Perfis de Usuários</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="dashboards-tab" data-toggle="tab" href="#dashboards" role="tab">Dashboards AWS</a>
      </li>
    </ul>
    
    <!-- Conteúdo das tabs -->
    <div class="tab-content" id="adminTabsContent">
      <!-- Tab de Usuários -->
      <div class="tab-pane fade show active" id="usuarios" role="tabpanel">
        <div class="card mt-3">
          <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Usuários Registrados</h5>
            <button class="btn btn-sm btn-light" id="refreshUsuarios">Atualizar Dados</button>
          </div>
          <div class="card-body">
            <div id="userStats" class="mb-3">
              <div class="alert alert-info">Carregando estatísticas...</div>
            </div>
            <div class="table-responsive">
              <table class="table table-striped table-bordered" id="usuariosTable">
                <thead class="thead-dark">
                  <tr>
                    <th>Nome</th>
                    <th>Telefone</th>
                    <th>Status</th>
                    <th>Data Cadastro</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="usuariosTableBody">
                  <tr>
                    <td colspan="5" class="text-center">Carregando usuários...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Tab de Conteúdos -->
      <div class="tab-pane fade" id="conteudos" role="tabpanel">
        <div class="card mt-3">
          <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Conteúdos Gerados</h5>
            <button class="btn btn-sm btn-light" id="refreshConteudos">Atualizar Dados</button>
          </div>
          <div class="card-body">
            <div id="conteudosStats" class="mb-3">
              <div class="alert alert-info">Carregando estatísticas...</div>
            </div>
            <div class="table-responsive">
              <table class="table table-striped table-bordered" id="conteudosTable">
                <thead class="thead-dark">
                  <tr>
                    <th>ID</th>
                    <th>Tipo</th>
                    <th>Usuário</th>
                    <th>Data Criação</th>
                    <th>Conteúdo</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="conteudosTableBody">
                  <tr>
                    <td colspan="6" class="text-center">Carregando conteúdos...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Tab de Kanban -->
      <div class="tab-pane fade" id="kanban" role="tabpanel">
        <div class="card mt-3">
          <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Kanban de Jornada do Usuário</h5>
            <button class="btn btn-sm btn-light" id="refreshKanban">
              <i class="fas fa-sync-alt"></i> Atualizar
            </button>
          </div>
          <div class="card-body">
            <!-- Filtro e legenda -->
            <div class="row mb-3">
              <div class="col-md-6">
                <div class="input-group">
                  <input type="text" class="form-control" placeholder="Filtrar usuários..." id="kanbanFilter">
                  <div class="input-group-append">
                    <button class="btn btn-outline-secondary" type="button" id="applyFilter">
                      <i class="fas fa-search"></i>
                    </button>
                  </div>
                </div>
              </div>
              <div class="col-md-6 text-right">
                <span class="badge badge-primary">Total: <span id="kanbanTotalUsuarios">0</span></span>
              </div>
            </div>
            
            <!-- Quadro Kanban -->
            <div class="kanban-board">
              <div class="row">
                <!-- Coluna: Novo -->
                <div class="col-md-3 kanban-column">
                  <div class="card">
                    <div class="card-header bg-info text-white">
                      Novos <span class="badge badge-light" id="count-novos">0</span>
                    </div>
                    <div class="card-body kanban-cards" id="kanban-novos">
                      <div class="text-center text-muted">
                        <i class="fas fa-spinner fa-spin"></i> Carregando...
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Coluna: Em Onboarding -->
                <div class="col-md-3 kanban-column">
                  <div class="card">
                    <div class="card-header bg-warning text-white">
                      Em Onboarding <span class="badge badge-light" id="count-onboarding">0</span>
                    </div>
                    <div class="card-body kanban-cards" id="kanban-onboarding">
                      <div class="text-center text-muted">
                        <i class="fas fa-spinner fa-spin"></i> Carregando...
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Coluna: Em Progresso -->
                <div class="col-md-3 kanban-column">
                  <div class="card">
                    <div class="card-header bg-success text-white">
                      Em Progresso <span class="badge badge-light" id="count-em-progresso">0</span>
                    </div>
                    <div class="card-body kanban-cards" id="kanban-em-progresso">
                      <div class="text-center text-muted">
                        <i class="fas fa-spinner fa-spin"></i> Carregando...
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Coluna: Concluído -->
                <div class="col-md-3 kanban-column">
                  <div class="card">
                    <div class="card-header bg-secondary text-white">
                      Concluído <span class="badge badge-light" id="count-concluido">0</span>
                    </div>
                    <div class="card-body kanban-cards" id="kanban-concluido">
                      <div class="text-center text-muted">
                        <i class="fas fa-spinner fa-spin"></i> Carregando...
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Tab de Perfis de Usuários -->
      <div class="tab-pane fade" id="perfis" role="tabpanel">
        <div class="card mt-3">
          <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Análise de Perfis de Usuários</h5>
            <button class="btn btn-sm btn-light" id="refreshPerfis">
              <i class="fas fa-sync-alt"></i> Atualizar
            </button>
          </div>
          <div class="card-body">
            <div class="row mb-4">
              <div class="col-md-12">
                <div class="alert alert-info" id="perfisInfo">
                  <i class="fas fa-info-circle"></i> Esta visualização mostra estatísticas sobre as escolhas e preferências dos usuários do sistema.
                </div>
              </div>
            </div>
            
            <!-- Primeira linha de gráficos -->
            <div class="row mb-4">
              <!-- Gráfico de interesses primários -->
              <div class="col-md-6">
                <div class="card shadow-sm">
                  <div class="card-header bg-light">
                    <h6 class="mb-0">Interesses Primários dos Usuários</h6>
                  </div>
                  <div class="card-body">
                    <canvas id="chartInteressesPrimarios" height="250"></canvas>
                  </div>
                </div>
              </div>
              
              <!-- Gráfico de frequência de mensagens -->
              <div class="col-md-6">
                <div class="card shadow-sm">
                  <div class="card-header bg-light">
                    <h6 class="mb-0">Preferência de Frequência de Mensagens</h6>
                  </div>
                  <div class="card-body">
                    <canvas id="chartFrequenciaMensagens" height="250"></canvas>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Segunda linha de gráficos -->
            <div class="row mb-4">
              <!-- Gráfico de tipos de conteúdos favoritos -->
              <div class="col-md-6">
                <div class="card shadow-sm">
                  <div class="card-header bg-light">
                    <h6 class="mb-0">Tipos de Conteúdo Preferidos</h6>
                  </div>
                  <div class="card-body">
                    <canvas id="chartTiposConteudo" height="250"></canvas>
                  </div>
                </div>
              </div>
              
              <!-- Gráfico de formato de conteúdo preferido -->
              <div class="col-md-6">
                <div class="card shadow-sm">
                  <div class="card-header bg-light">
                    <h6 class="mb-0">Formato de Conteúdo Preferido</h6>
                  </div>
                  <div class="card-body">
                    <canvas id="chartFormatoConteudo" height="250"></canvas>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Terceira linha de gráficos e estatísticas -->
            <div class="row mb-4">
              <!-- Gráfico de cargos/funções -->
              <div class="col-md-6">
                <div class="card shadow-sm">
                  <div class="card-header bg-light">
                    <h6 class="mb-0">Cargos/Funções dos Usuários</h6>
                  </div>
                  <div class="card-body">
                    <canvas id="chartCargos" height="250"></canvas>
                  </div>
                </div>
              </div>
              
              <!-- Gráfico de tamanho das empresas -->
              <div class="col-md-6">
                <div class="card shadow-sm">
                  <div class="card-header bg-light">
                    <h6 class="mb-0">Tamanho das Empresas</h6>
                  </div>
                  <div class="card-body">
                    <canvas id="chartTamanhoEmpresa" height="250"></canvas>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Quarta linha com mapa de calor de horários preferidos -->
            <div class="row mb-4">
              <div class="col-md-12">
                <div class="card shadow-sm">
                  <div class="card-header bg-light">
                    <h6 class="mb-0">Horários Preferidos para Receber Conteúdo</h6>
                  </div>
                  <div class="card-body">
                    <canvas id="chartHorarioPreferido" height="200"></canvas>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Quinta linha com dados de engajamento -->
            <div class="row">
              <div class="col-md-12">
                <div class="card shadow-sm">
                  <div class="card-header bg-light">
                    <h6 class="mb-0">Desafios Mais Comuns Relatados</h6>
                  </div>
                  <div class="card-body">
                    <canvas id="chartDesafios" height="250"></canvas>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Tab de Dashboards AWS -->
      <div class="tab-pane fade" id="dashboards" role="tabpanel">
        <div class="card mt-3">
          <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Dashboards AWS</h5>
            <button class="btn btn-sm btn-light" id="refreshDashboards">
              <i class="fas fa-sync-alt"></i> Atualizar
            </button>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-striped table-bordered" id="dashboardsTable">
                <thead class="thead-dark">
                  <tr>
                    <th>Nome</th>
                    <th>URL</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody id="dashboardsTableBody">
                  <tr>
                    <td colspan="3" class="text-center">Carregando dashboards...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para detalhes -->
  <div class="modal fade" id="detailsModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalTitle">Detalhes</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="modalBody">
          <!-- Conteúdo dinâmico aqui -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Adicione isso logo após o elemento body -->
  <div id="debug-info" style="position: fixed; bottom: 0; right: 0; background: #f8f9fa; border: 1px solid #ddd; padding: 10px; max-width: 400px; max-height: 200px; overflow: auto; z-index: 9999; font-size: 12px; display: none;">
    <h6><i class="fas fa-bug"></i> Informações de Depuração</h6>
    <div id="debug-content"></div>
  </div>

  <!-- Verificação de jQuery - adicionado após o jQuery e antes dos outros scripts -->
  <script>
    // Verificar se jQuery está disponível
    if (typeof jQuery === 'undefined') {
      console.error('ERRO CRÍTICO: jQuery não está carregado!');
      document.body.innerHTML = '<div style="padding: 20px; background-color: #f8d7da; color: #721c24; margin: 20px;">ERRO: jQuery não foi carregado corretamente. Por favor, recarregue a página ou contate o suporte.</div>';
    } else {
      console.log('jQuery carregado corretamente! Versão:', $.fn.jquery);
    }
  </script>
  
  <!-- Outros scripts após a verificação -->
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <!-- Script para funções administrativas -->
  <script src="admin-functions.js"></script>

  <!-- Scripts específicos para funcionalidades da interface -->
  <script>
    $(document).ready(function() {
      // Função para carregar usuários
      function loadUsuarios() {
        $('#userStats').html(`
          <div class="alert alert-info">
            <i class="fas fa-spinner fa-spin"></i> Carregando estatísticas de usuários...
          </div>
        `);
        
        $('#usuariosTableBody').html(`
          <tr>
            <td colspan="5" class="text-center">
              <i class="fas fa-spinner fa-spin"></i> Carregando usuários...
            </td>
          </tr>
        `);
        
        $.ajax({
          url: '/api/usuarios',
          method: 'GET',
          success: function(response) {
            // Atualizar estatísticas
            const total = response.count || 0;
            const ativos = response.ativos || 0;
            const percentAtivos = total > 0 ? ((ativos / total) * 100).toFixed(1) : 0;
            
            $('#userStats').html(`
              <div class="row">
                <div class="col-md-4">
                  <div class="card bg-primary text-white">
                    <div class="card-body text-center">
                      <h3>${total}</h3>
                      <p class="mb-0">Total de Usuários</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card bg-success text-white">
                    <div class="card-body text-center">
                      <h3>${ativos}</h3>
                      <p class="mb-0">Usuários Ativos</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card bg-info text-white">
                    <div class="card-body text-center">
                      <h3>${percentAtivos}%</h3>
                      <p class="mb-0">Taxa de Ativação</p>
                    </div>
                  </div>
                </div>
              </div>
            `);
            
            // Limpar e preencher tabela
            $('#usuariosTableBody').empty();
            
            if (response.usuarios && response.usuarios.length > 0) {
              response.usuarios.forEach(function(usuario) {
                const nome = usuario.name || 'Sem nome';
                const telefone = usuario.phoneNumber || usuario.telefone || 'Não informado';
                const status = determinarStatus(usuario);
                const dataCadastro = formatarData(usuario.createdAt || usuario.dataCadastro || new Date().toISOString());
                
                $('#usuariosTableBody').append(`
                  <tr>
                    <td>${nome}</td>
                    <td>${telefone}</td>
                    <td class="${status === 'Ativo' ? 'status-ativo' : 'status-inativo'}">${status}</td>
                    <td>${dataCadastro}</td>
                    <td>
                      <button class="btn btn-sm btn-info ver-detalhes" data-id="${usuario.userId || usuario.id}">
                        <i class="fas fa-eye"></i>
                      </button>
                      <button class="btn btn-sm btn-danger remover-usuario" data-id="${usuario.userId || usuario.id}">
                        <i class="fas fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                `);
              });
              
              // Adicionar event listeners para botões
              $('.ver-detalhes').click(function() {
                const userId = $(this).data('id');
                mostrarDetalhesUsuario(userId, response.usuarios);
              });
              
              $('.remover-usuario').click(function() {
                const userId = $(this).data('id');
                confirmarRemocaoUsuario(userId);
              });
            } else {
              $('#usuariosTableBody').html(`
                <tr>
                  <td colspan="5" class="text-center">Nenhum usuário encontrado</td>
                </tr>
              `);
            }
          },
          error: function(xhr, status, error) {
            $('#userStats').html(`
              <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle"></i> 
                Erro ao carregar estatísticas: ${error}
              </div>
            `);
            
            $('#usuariosTableBody').html(`
              <tr>
                <td colspan="5" class="text-center text-danger">
                  Erro ao carregar usuários: ${error}
                </td>
              </tr>
            `);
            console.error('Erro ao carregar usuários:', error);
          }
        });
      }
      
      // Função para carregar conteúdos
      function loadConteudos() {
        $('#conteudosStats').html(`
          <div class="alert alert-info">
            <i class="fas fa-spinner fa-spin"></i> Carregando estatísticas de conteúdos...
          </div>
        `);
        
        $('#conteudosTableBody').html(`
          <tr>
            <td colspan="6" class="text-center">
              <i class="fas fa-spinner fa-spin"></i> Carregando conteúdos...
            </td>
          </tr>
        `);
        
        $.ajax({
          url: '/api/conteudos',
          method: 'GET',
          success: function(response) {
            // Atualizar estatísticas
            const total = response.count || 0;
            const categorias = response.categorias || {};
            
            let categoriasHTML = '';
            for (const [categoria, count] of Object.entries(categorias)) {
              categoriasHTML += `<span class="badge badge-primary mr-2">${categoria}: ${count}</span>`;
            }
            
            $('#conteudosStats').html(`
              <div class="row">
                <div class="col-md-4">
                  <div class="card bg-primary text-white">
                    <div class="card-body text-center">
                      <h3>${total}</h3>
                      <p class="mb-0">Total de Conteúdos</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-8">
                  <div class="card">
                    <div class="card-body">
                      <h5>Categorias:</h5>
                      <p>${categoriasHTML || 'Nenhuma categoria encontrada'}</p>
                    </div>
                  </div>
                </div>
              </div>
            `);
            
            // Limpar e preencher tabela
            $('#conteudosTableBody').empty();
            
            if (response.conteudos && response.conteudos.length > 0) {
              response.conteudos.forEach(function(conteudo) {
                const id = conteudo.contentId || conteudo.id || 'ID não disponível';
                const tipo = conteudo.contentType || conteudo.tipo || 'Não especificado';
                const usuario = conteudo.userId || conteudo.usuarioId || 'Sistema';
                const dataCriacao = formatarData(conteudo.createdAt || conteudo.dataCriacao || new Date().toISOString());
                
                // Preparar preview do conteúdo
                let previewConteudo = '';
                if (conteudo.versions && conteudo.versions.brief) {
                  previewConteudo = conteudo.versions.brief.substring(0, 100) + '...';
                } else if (conteudo.conteudo) {
                  previewConteudo = conteudo.conteudo.substring(0, 100) + '...';
                } else {
                  previewConteudo = 'Conteúdo não disponível';
                }
                
                $('#conteudosTableBody').append(`
                  <tr>
                    <td>${id}</td>
                    <td>${tipo}</td>
                    <td>${usuario}</td>
                    <td>${dataCriacao}</td>
                    <td>${previewConteudo}</td>
                    <td>
                      <button class="btn btn-sm btn-info ver-conteudo" data-id="${id}">
                        <i class="fas fa-eye"></i>
                      </button>
                    </td>
                  </tr>
                `);
              });
              
              // Adicionar event listeners para botões
              $('.ver-conteudo').click(function() {
                const contentId = $(this).data('id');
                mostrarDetalhesConteudo(contentId, response.conteudos);
              });
            } else {
              $('#conteudosTableBody').html(`
                <tr>
                  <td colspan="6" class="text-center">Nenhum conteúdo encontrado</td>
                </tr>
              `);
            }
          },
          error: function(xhr, status, error) {
            $('#conteudosStats').html(`
              <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle"></i> 
                Erro ao carregar estatísticas: ${error}
              </div>
            `);
            
            $('#conteudosTableBody').html(`
              <tr>
                <td colspan="6" class="text-center text-danger">
                  Erro ao carregar conteúdos: ${error}
                </td>
              </tr>
            `);
            console.error('Erro ao carregar conteúdos:', error);
          }
        });
      }
      
      // Função para carregar dados do Kanban
      function loadKanbanData() {
        // Limpar quadros kanban e adicionar indicadores de carregamento
        ['novos', 'onboarding', 'em-progresso', 'concluido'].forEach(coluna => {
          $(`#kanban-${coluna}`).html(`
            <div class="text-center text-muted">
              <i class="fas fa-spinner fa-spin"></i> Carregando...
            </div>
          `);
          $(`#count-${coluna}`).text('0');
        });
        
        // Carregar usuários para o kanban
        $.ajax({
          url: '/api/usuarios',
          method: 'GET',
          success: function(response) {
            // Mapa para distribuir usuários nas colunas do kanban
            const kanbanMap = {
              'novos': [],
              'onboarding': [],
              'em-progresso': [],
              'concluido': []
            };
            
            // Classificar usuários por coluna
            if (response.usuarios && response.usuarios.length > 0) {
              $('#kanbanTotalUsuarios').text(response.usuarios.length);
              
              response.usuarios.forEach(usuario => {
                // Determinar a coluna com base no status e comportamento
                let coluna = 'novos';
                
                if (usuario.onboardingCompleted) {
                  coluna = 'em-progresso';
                  
                  // Se tiver alto engajamento, mover para completado
                  if (usuario.engagement && usuario.engagement.engagementScore > 70) {
                    coluna = 'concluido';
                  }
                } else if (usuario.lastActive) {
                  // Se não completou onboarding mas tem atividade, está em onboarding
                  coluna = 'onboarding';
                }
                
                // Adicionar à coluna correspondente
                kanbanMap[coluna].push(usuario);
              });
              
              // Preencher cada coluna do kanban
              for (const [coluna, usuarios] of Object.entries(kanbanMap)) {
                $(`#count-${coluna}`).text(usuarios.length);
                
                if (usuarios.length === 0) {
                  $(`#kanban-${coluna}`).html(`
                    <div class="text-center text-muted">
                      <i class="fas fa-inbox"></i> Nenhum usuário nesta coluna
                    </div>
                  `);
                  continue;
                }
                
                $(`#kanban-${coluna}`).empty();
                
                // Adicionar cartões para cada usuário
                usuarios.forEach(usuario => {
                  const nome = usuario.name || 'Usuário sem nome';
                  const telefone = usuario.phoneNumber || usuario.telefone || 'Sem telefone';
                  const dataCadastro = formatarData(usuario.createdAt || usuario.dataCadastro || new Date().toISOString());
                  
                  let statusClass = '';
                  switch (coluna) {
                    case 'novos': statusClass = 'kanban-card-novo'; break;
                    case 'onboarding': statusClass = 'kanban-card-onboarding'; break;
                    case 'em-progresso': statusClass = 'kanban-card-ativo'; break;
                    case 'concluido': statusClass = 'kanban-card-inativo'; break;
                  }
                  
                  $(`#kanban-${coluna}`).append(`
                    <div class="card kanban-card ${statusClass}" data-id="${usuario.userId || usuario.id}">
                      <div class="kanban-card-header">
                        <strong>${nome}</strong>
                        <div class="dropdown">
                          <button class="btn btn-sm py-0 px-1" type="button" data-toggle="dropdown">
                            <i class="fas fa-ellipsis-v"></i>
                          </button>
                          <div class="dropdown-menu dropdown-menu-right">
                            <a class="dropdown-item ver-usuario" href="#" data-id="${usuario.userId || usuario.id}">
                              <i class="fas fa-eye"></i> Ver detalhes
                            </a>
                            <a class="dropdown-item mover-usuario" href="#" data-coluna="novos">
                              <i class="fas fa-arrow-right"></i> Mover para Novos
                            </a>
                            <a class="dropdown-item mover-usuario" href="#" data-coluna="onboarding">
                              <i class="fas fa-arrow-right"></i> Mover para Onboarding
                            </a>
                            <a class="dropdown-item mover-usuario" href="#" data-coluna="em-progresso">
                              <i class="fas fa-arrow-right"></i> Mover para Em Progresso
                            </a>
                            <a class="dropdown-item mover-usuario" href="#" data-coluna="concluido">
                              <i class="fas fa-arrow-right"></i> Mover para Concluído
                            </a>
                          </div>
                        </div>
                      </div>
                      <div class="kanban-card-body">
                        <div><i class="fas fa-phone-alt"></i> ${telefone}</div>
                        <div class="mt-1">
                          ${usuario.profile && usuario.profile.role ? 
                            `<span class="badge badge-secondary">${usuario.profile.role}</span>` : ''}
                          ${usuario.profile && usuario.profile.industry ? 
                            `<span class="badge badge-info">${usuario.profile.industry}</span>` : ''}
                        </div>
                      </div>
                      <div class="kanban-card-footer">
                        <span><i class="far fa-calendar-alt"></i> ${dataCadastro}</span>
                        <span>
                          ${usuario.engagement && usuario.engagement.engagementScore ? 
                            `<i class="fas fa-chart-line"></i> ${usuario.engagement.engagementScore}` : 
                            '<i class="fas fa-circle"></i> Novo'}
                        </span>
                      </div>
                    </div>
                  `);
                });
                
                // Adicionar listeners para os botões de ação
                $(`#kanban-${coluna} .ver-usuario`).click(function(e) {
                  e.preventDefault();
                  const id = $(this).data('id');
                  mostrarDetalhesUsuario(id, response.usuarios);
                });
                
                $(`#kanban-${coluna} .mover-usuario`).click(function(e) {
                  e.preventDefault();
                  const id = $(this).closest('.kanban-card').data('id');
                  const colunaDestino = $(this).data('coluna');
                  // Aqui você pode implementar o código para mover o usuário
                  // entre as colunas (via API) ou apenas visualmente
                  alert(`Movendo usuário ${id} para ${colunaDestino}`);
                });
              }
            } else {
              ['novos', 'onboarding', 'em-progresso', 'concluido'].forEach(coluna => {
                $(`#kanban-${coluna}`).html(`
                  <div class="text-center text-muted">
                    <i class="fas fa-exclamation-circle"></i> Sem dados disponíveis
                  </div>
                `);
              });
              
              $('#kanbanTotalUsuarios').text('0');
            }
          },
          error: function(xhr, status, error) {
            ['novos', 'onboarding', 'em-progresso', 'concluido'].forEach(coluna => {
              $(`#kanban-${coluna}`).html(`
                <div class="text-center text-danger">
                  <i class="fas fa-exclamation-triangle"></i>
                  Erro ao carregar dados: ${error}
                </div>
              `);
            });
            
            console.error('Erro ao carregar dados do kanban:', error);
          }
        });
      }
      
      // Funções utilitárias
      function determinarStatus(usuario) {
        if (usuario.status === 'ativo' || 
            usuario.ativo === true || 
            usuario.situacao === 'ativo' || 
            usuario.active === true ||
            (typeof usuario.status === 'number' && usuario.status === 1)) {
          return 'Ativo';
        } else {
          return 'Inativo';
        }
      }
      
      function formatarData(dataStr) {
        try {
          const data = new Date(dataStr);
          return data.toLocaleDateString('pt-BR', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          });
        } catch (e) {
          return 'Data inválida';
        }
      }
      
      function mostrarDetalhesUsuario(userId, usuarios) {
        const usuario = usuarios.find(u => (u.userId || u.id) === userId);
        
        if (!usuario) {
          alert('Usuário não encontrado!');
          return;
        }
        
        let detalhesHTML = `
          <div class="row">
            <div class="col-md-6">
              <h5>Informações Básicas</h5>
              <table class="table table-sm">
                <tr>
                  <th>ID:</th>
                  <td>${usuario.userId || usuario.id || 'N/A'}</td>
                </tr>
                <tr>
                  <th>Nome:</th>
                  <td>${usuario.name || 'Não informado'}</td>
                </tr>
                <tr>
                  <th>Telefone:</th>
                  <td>${usuario.phoneNumber || usuario.telefone || 'Não informado'}</td>
                </tr>
                <tr>
                  <th>Email:</th>
                  <td>${usuario.email || 'Não informado'}</td>
                </tr>
                <tr>
                  <th>Status:</th>
                  <td class="${determinarStatus(usuario) === 'Ativo' ? 'status-ativo' : 'status-inativo'}">
                    ${determinarStatus(usuario)}
                  </td>
                </tr>
                <tr>
                  <th>Data Cadastro:</th>
                  <td>${formatarData(usuario.createdAt || usuario.dataCadastro || '')}</td>
                </tr>
                <tr>
                  <th>Última Atividade:</th>
                  <td>${formatarData(usuario.lastActive || usuario.ultimaAtividade || '')}</td>
                </tr>
              </table>
            </div>
            <div class="col-md-6">
              <h5>Perfil e Preferências</h5>
              <div class="card mb-3">
                <div class="card-body">
                  ${usuario.profile ? `
                    <p><strong>Cargo:</strong> ${usuario.profile.role || 'Não informado'}</p>
                    <p><strong>Empresa:</strong> ${usuario.profile.companySize || 'Não informado'}</p>
                    <p><strong>Indústria:</strong> ${usuario.profile.industry || 'Não informado'}</p>
                    <p><strong>Localização:</strong> ${
                      usuario.profile.location ? 
                      `${usuario.profile.location.city || ''}, ${usuario.profile.location.state || ''}` :
                      'Não informada'
                    }</p>
                  ` : '<p>Perfil não disponível</p>'}
                  
                  ${usuario.preferences ? `
                    <hr>
                    <p><strong>Interesse Principal:</strong> ${usuario.preferences.primaryInterest || 'Não informado'}</p>
                    <p><strong>Frequência de Mensagens:</strong> ${usuario.preferences.messageFrequency || 'Não informado'}</p>
                    <p><strong>Formato Preferido:</strong> ${usuario.preferences.preferredContentFormat || 'Não informado'}</p>
                  ` : ''}
                </div>
              </div>
            </div>
          </div>
        `;
        
        $('#modalTitle').text(`Detalhes do Usuário: ${usuario.name || 'Sem nome'}`);
        $('#modalBody').html(detalhesHTML);
        $('#detailsModal').modal('show');
      }
      
      function mostrarDetalhesConteudo(contentId, conteudos) {
        const conteudo = conteudos.find(c => (c.contentId || c.id) === contentId);
        
        if (!conteudo) {
          alert('Conteúdo não encontrado!');
          return;
        }
        
        let detalhesHTML = `
          <div class="row">
            <div class="col-md-5">
              <h5>Informações Básicas</h5>
              <table class="table table-sm">
                <tr>
                  <th>ID:</th>
                  <td>${conteudo.contentId || conteudo.id || 'N/A'}</td>
                </tr>
                <tr>
                  <th>Tipo:</th>
                  <td>${conteudo.contentType || conteudo.tipo || 'Não especificado'}</td>
                </tr>
                <tr>
                  <th>Usuário:</th>
                  <td>${conteudo.userId || conteudo.usuarioId || 'Sistema'}</td>
                </tr>
                <tr>
                  <th>Data Criação:</th>
                  <td>${formatarData(conteudo.createdAt || conteudo.dataCriacao || '')}</td>
                </tr>
                <tr>
                  <th>Categorias:</th>
                  <td>${
                    conteudo.categories ? 
                    conteudo.categories.map(cat => `<span class="badge badge-info mr-1">${cat}</span>`).join('') :
                    (conteudo.categoria ? `<span class="badge badge-info">${conteudo.categoria}</span>` : 'Não especificado')
                  }</td>
                </tr>
              </table>
            </div>
            <div class="col-md-7">
              <h5>Conteúdo</h5>
              <div class="card">
                <div class="card-body">
                  ${conteudo.versions ? `
                    <ul class="nav nav-tabs" id="contentTabs" role="tablist">
                      <li class="nav-item">
                        <a class="nav-link active" id="brief-tab" data-toggle="tab" href="#brief" role="tab">Resumido</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" id="detailed-tab" data-toggle="tab" href="#detailed" role="tab">Detalhado</a>
                      </li>
                    </ul>
                    <div class="tab-content mt-2" id="contentTabsContent">
                      <div class="tab-pane fade show active" id="brief" role="tabpanel">
                        <p>${conteudo.versions.brief || 'Não disponível'}</p>
                      </div>
                      <div class="tab-pane fade" id="detailed" role="tabpanel">
                        <p>${conteudo.versions.detailed || 'Não disponível'}</p>
                      </div>
                    </div>
                  ` : (conteudo.conteudo ? `<p>${conteudo.conteudo}</p>` : '<p>Conteúdo não disponível</p>')}
                </div>
              </div>
              
              ${conteudo.metrics ? `
                <div class="card mt-3">
                  <div class="card-header">Métricas</div>
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-4 text-center">
                        <h4>${conteudo.metrics.impressions || 0}</h4>
                        <small>Impressões</small>
                      </div>
                      <div class="col-md-4 text-center">
                        <h4>${conteudo.metrics.clicks || 0}</h4>
                        <small>Cliques</small>
                      </div>
                      <div class="col-md-4 text-center">
                        <h4>${conteudo.metrics.feedbackScore || 0}</h4>
                        <small>Avaliação</small>
                      </div>
                    </div>
                  </div>
                </div>
              ` : ''}
            </div>
          </div>
        `;
        
        $('#modalTitle').text(`Detalhes do Conteúdo: ${conteudo.title || conteudo.contentId || ''}`);
        $('#modalBody').html(detalhesHTML);
        $('#detailsModal').modal('show');
      }
      
      function confirmarRemocaoUsuario(userId) {
        if (confirm(`Tem certeza que deseja remover o usuário ${userId}?`)) {
          // Aqui você pode implementar a chamada à API para remover o usuário
          alert(`Solicitação para remover o usuário ${userId} enviada.`);
        }
      }

      // Função para carregar os dashboards
      function loadDashboards() {
        $('#dashboardsList').html(`
          <div class="text-center">
            <div class="spinner-border text-primary" role="status">
              <span class="sr-only">Carregando...</span>
            </div>
            <p>Carregando dashboards...</p>
          </div>
        `);
        
        $.ajax({
          url: '/api/dashboards',
          method: 'GET',
          success: function(data) {
            $('#dashboardsList').empty();
            
            if (data.dashboards.length === 0) {
              $('#dashboardsList').html('<div class="alert alert-warning">Nenhum dashboard encontrado no CloudWatch</div>');
              return;
            }
            
            data.dashboards.forEach(function(dashboard) {
              $('#dashboardsList').append(`
                <a href="${dashboard.url}" target="_blank" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                  <div>
                    <i class="fas fa-chart-line mr-2"></i>
                    ${dashboard.name}
                  </div>
                  <span class="badge badge-primary badge-pill">Abrir <i class="fas fa-external-link-alt ml-1"></i></span>
                </a>
              `);
            });
            
            // Adicionar link para o dashboard principal
            const region = data.region || 'us-east-1';
            $('#dashboardsList').append(`
              <a href="https://console.aws.amazon.com/cloudwatch/home?region=${region}#dashboards:name=RadarTendenciasDashboard" 
                 target="_blank" class="list-group-item list-group-item-action list-group-item-primary d-flex justify-content-between align-items-center">
                <div>
                  <i class="fas fa-star mr-2"></i>
                  RadarTendenciasDashboard (Principal)
                </div>
                <span class="badge badge-primary badge-pill">Abrir <i class="fas fa-external-link-alt ml-1"></i></span>
              </a>
            `);
          },
          error: function(err) {
            console.error('Erro ao carregar dashboards:', err);
            $('#dashboardsList').html(`<div class="alert alert-danger">
              Erro ao carregar dashboards: ${err.responseJSON?.error || err.statusText || 'Erro desconhecido'}
            </div>`);
          }
        });
      }
      
      // Função para carregar dados da aba de perfis de usuários
      function loadPerfisUsuarios() {
        $('#perfisInfo').html(`
          <i class="fas fa-spinner fa-spin"></i> Carregando dados de perfis dos usuários...
        `);
        
        // Fazer a solicitação para obter os dados dos usuários
        $.ajax({
          url: '/api/usuarios/perfis',
          method: 'GET',
          success: function(response) {
            $('#perfisInfo').html(`
              <i class="fas fa-info-circle"></i> Análise baseada em ${response.count} usuários.
              Última atualização: ${new Date().toLocaleString('pt-BR')}
            `);
            
            // Processa e exibe os dados como gráficos
            processarDadosPerfil(response.estatisticas);
          },
          error: function(xhr, status, error) {
            $('#perfisInfo').html(`
              <i class="fas fa-exclamation-triangle text-danger"></i> 
              Erro ao carregar dados de perfis: ${error}
            `);
            console.error('Erro ao carregar perfis:', error);
          }
        });
      }
      
      // Função para processar os dados e criar os gráficos
      function processarDadosPerfil(dados) {
        // Garantir que temos dados para trabalhar
        if (!dados || dados.erro) {
          $('#perfisInfo').html(`
            <i class="fas fa-exclamation-triangle text-warning"></i> 
            Nenhum dado de usuário disponível para análise: ${dados.erro || "Erro desconhecido"}
          `);
          return;
        }
        
        // Traduzir os nomes de interesses para português
        const traducaoInteresses = {
          'social_media_marketing': 'Marketing em Redes Sociais',
          'content_marketing': 'Marketing de Conteúdo',
          'seo': 'SEO',
          'email_marketing': 'E-mail Marketing',
          'inbound_marketing': 'Inbound Marketing',
          'performance_marketing': 'Marketing de Performance',
          'affiliate_marketing': 'Marketing de Afiliados'
        };
        
        // Traduzir frequências para português
        const traducaoFreq = {
          'high': 'Alta',
          'medium': 'Média',
          'low': 'Baixa'
        };
        
        // Traduzir tipos de conteúdo para português
        const traducaoTipos = {
          'news': 'Notícias',
          'tools': 'Ferramentas',
          'cases': 'Casos de Uso',
          'tips': 'Dicas',
          'tutorials': 'Tutoriais',
          'insights': 'Insights'
        };
        
        // Traduzir formatos para português
        const traducaoFormatos = {
          'brief': 'Resumido',
          'detailed': 'Detalhado',
          'visual': 'Visual'
        };
        
        // Traduzir cargos para português
        const traducaoCargos = {
          'marketing_manager': 'Gerente de Marketing',
          'digital_marketing_specialist': 'Especialista em Marketing Digital',
          'social_media_manager': 'Gerente de Mídias Sociais',
          'content_creator': 'Criador de Conteúdo',
          'entrepreneur': 'Empreendedor',
          'marketing_analyst': 'Analista de Marketing',
          'seo_specialist': 'Especialista em SEO',
          'other': 'Outros'
        };
        
        // Traduzir tamanhos para português
        const traducaoTamanhos = {
          '1-10': '1-10 funcionários',
          '11-50': '11-50 funcionários',
          '51-200': '51-200 funcionários',
          '201-500': '201-500 funcionários',
          '501-1000': '501-1000 funcionários',
          '1000+': 'Mais de 1000 funcionários'
        };
        
        // Traduzir desafios para português
        const traducaoDesafios = {
          'lead_generation': 'Geração de Leads',
          'content_creation': 'Criação de Conteúdo',
          'audience_engagement': 'Engajamento de Audiência',
          'organic_growth': 'Crescimento Orgânico',
          'roi_measurement': 'Medição de ROI',
          'customer_acquisition': 'Aquisição de Clientes',
          'content_strategy': 'Estratégia de Conteúdo',
          'brand_awareness': 'Reconhecimento de Marca'
        };
        
        // Função para destruir gráfico de forma segura
        function destroyChart(chartInstance) {
          if (chartInstance && typeof chartInstance.destroy === 'function') {
            chartInstance.destroy();
          }
        }
        
        // 1. Gráfico de Interesses Primários
        const ctxInteresses = document.getElementById('chartInteressesPrimarios').getContext('2d');
        destroyChart(window.chartInteresses);
        window.chartInteresses = new Chart(ctxInteresses, {
          type: 'doughnut',
          data: {
            labels: Object.keys(dados.interessesPrimarios).map(key => traducaoInteresses[key] || key),
            datasets: [{
              data: Object.values(dados.interessesPrimarios),
              backgroundColor: [
                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#C9CBCF'
              ]
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'right',
              },
              title: {
                display: true,
                text: 'Distribuição de Interesses Primários'
              }
            }
          }
        });
        
        // 2. Gráfico de Frequência de Mensagens
        const ctxFreq = document.getElementById('chartFrequenciaMensagens').getContext('2d');
        destroyChart(window.chartFreq);
        window.chartFreq = new Chart(ctxFreq, {
          type: 'pie',
          data: {
            labels: Object.keys(dados.freqMensagens).map(key => traducaoFreq[key] || key),
            datasets: [{
              data: Object.values(dados.freqMensagens),
              backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56']
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'right',
              },
              title: {
                display: true,
                text: 'Preferência de Frequência de Mensagens'
              }
            }
          }
        });
        
        // 3. Gráfico de Tipos de Conteúdo Preferidos
        const ctxTipos = document.getElementById('chartTiposConteudo').getContext('2d');
        destroyChart(window.chartTipos);
        window.chartTipos = new Chart(ctxTipos, {
          type: 'bar',
          data: {
            labels: Object.keys(dados.tiposConteudo).map(key => traducaoTipos[key] || key),
            datasets: [{
              label: 'Usuários',
              data: Object.values(dados.tiposConteudo),
              backgroundColor: '#36A2EB',
              borderWidth: 1
            }]
          },
          options: {
            indexAxis: 'y',
            responsive: true,
            plugins: {
              title: {
                display: true,
                text: 'Tipos de Conteúdo Mais Solicitados'
              },
              legend: {
                display: false
              }
            }
          }
        });
        
        // 4. Gráfico de Formato de Conteúdo Preferido
        const ctxFormatos = document.getElementById('chartFormatoConteudo').getContext('2d');
        destroyChart(window.chartFormatos);
        window.chartFormatos = new Chart(ctxFormatos, {
          type: 'pie',
          data: {
            labels: Object.keys(dados.formatosConteudo).map(key => traducaoFormatos[key] || key),
            datasets: [{
              data: Object.values(dados.formatosConteudo),
              backgroundColor: ['#FFCE56', '#4BC0C0', '#9966FF']
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'right',
              },
              title: {
                display: true,
                text: 'Formato de Conteúdo Preferido'
              }
            }
          }
        });
        
        // 5. Gráfico de Cargos
        const ctxCargos = document.getElementById('chartCargos').getContext('2d');
        destroyChart(window.chartCargos);
        window.chartCargos = new Chart(ctxCargos, {
          type: 'pie',
          data: {
            labels: Object.keys(dados.cargos).map(key => traducaoCargos[key] || key),
            datasets: [{
              data: Object.values(dados.cargos),
              backgroundColor: [
                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', 
                '#9966FF', '#FF9F40', '#C9CBCF', '#1B998B'
              ]
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'right',
              },
              title: {
                display: true,
                text: 'Distribuição de Cargos/Funções'
              }
            }
          }
        });
        
        // 6. Gráfico de Tamanho das Empresas
        const ctxTamanho = document.getElementById('chartTamanhoEmpresa').getContext('2d');
        destroyChart(window.chartTamanho);
        window.chartTamanho = new Chart(ctxTamanho, {
          type: 'bar',
          data: {
            labels: Object.keys(dados.tamanhoEmpresas).map(key => traducaoTamanhos[key] || key),
            datasets: [{
              label: 'Usuários',
              data: Object.values(dados.tamanhoEmpresas),
              backgroundColor: '#4BC0C0',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            indexAxis: 'y',
            plugins: {
              title: {
                display: true,
                text: 'Tamanho das Empresas'
              },
              legend: {
                display: false
              }
            }
          }
        });
        
        // 7. Gráfico de Desafios Mais Comuns
        const ctxDesafios = document.getElementById('chartDesafios').getContext('2d');
        destroyChart(window.chartDesafios);
        window.chartDesafios = new Chart(ctxDesafios, {
          type: 'bar',
          data: {
            labels: Object.keys(dados.desafios).map(key => traducaoDesafios[key] || key),
            datasets: [{
              label: 'Usuários',
              data: Object.values(dados.desafios),
              backgroundColor: '#9966FF',
              borderWidth: 1
            }]
          },
          options: {
            indexAxis: 'y',
            responsive: true,
            plugins: {
              title: {
                display: true,
                text: 'Desafios Mais Comuns Relatados'
              },
              legend: {
                display: false
              }
            }
          }
        });
        
        // 8. Gráfico de Horários Preferidos
        const ctxHorarios = document.getElementById('chartHorarioPreferido').getContext('2d');
        destroyChart(window.chartHorarios);
        
        // Criar rótulos para as horas
        const labelsHoras = [];
        for (let i = 0; i < 24; i++) {
          labelsHoras.push(`${i < 10 ? '0' + i : i}:00`);
        }
        
        window.chartHorarios = new Chart(ctxHorarios, {
          type: 'bar',
          data: {
            labels: labelsHoras,
            datasets: [{
              label: 'Preferência',
              data: dados.horariosPref,
              backgroundColor: '#FF9F40',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              title: {
                display: true,
                text: 'Horários Preferidos para Comunicação'
              },
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: 'Número de Usuários'
                }
              }
            }
          }
        });
      }
      
      // Carregar dados iniciais
      loadUsuarios();
      loadConteudos();
      loadKanbanData();
      loadDashboards();
      loadPerfisUsuarios();
      
      // Configurar eventos de atualização
      $('#refreshUsuarios').click(loadUsuarios);
      $('#refreshConteudos').click(loadConteudos);
      $('#refreshKanban').click(loadKanbanData);
      $('#refreshDashboards').click(loadDashboards);
      $('#refreshPerfis').click(loadPerfisUsuarios);
      
      // Tratar cliques em abas
      $('#adminTabs a').on('click', function (e) {
        e.preventDefault();
        $(this).tab('show');
      });
    });
  </script>
</body>
</html>
